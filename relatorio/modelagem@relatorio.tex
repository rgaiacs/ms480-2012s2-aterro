% Copyright (c) 2012 Raniere Silva <r.gaia.cs@gmail.com>
% Copyright (c) 2012 Fernando Cezarino <feolce@gmail.com>
% Copyright (c) 2012 Ana Paula Diniz Marques <anapdinizm@gmail.com>
% Copyright (c) 2012 Camile Kunz <camileknz@gmail.com>
% Copyright (c) 2012 Ana Flavia <anaflavia.c.lima@gmail.com>
%
% This file is part of 'MS480 - 2012S2 - Aterro com Obstáculo'.
%
% 'MS480 - 2012S2 - Aterro com Obstáculo' is licensed under the Creative
% Commons Attribution-ShareAlike 3.0 Unported License. To view a copy of
% this license, visit http://creativecommons.org/licenses/by-sa/3.0/.
%
% 'MS480 - 2012S2 - Aterro com Obstáculo' is distributed in the hope
% that it will be useful, but WITHOUT ANY WARRANTY; without even the
% implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
% PURPOSE.

\section{Modelagem}
A seguir apresentamos a modelagem proposta por Andjel e depois expandimos essa
modelagem para o problema a ser tratado. Ao final, abordamos a questão da
distância.

\subsection{Problema sem obstáculo}
Considere a Figura~\ref{fig:ilust_J_A} em que é representado as regiões $A$ e
$J$.
\begin{figure}[!htb]
    \centering
    \begin{tikzpicture}
        \draw[pattern=bricks] (0,0) -- (0,3) -- (2,2) -- (4,0) -- (0,0);
        \node[fill=white] at (1,1) {$A$};
        \draw[pattern=checkerboard] (6,6) -- (8,6) -- (8,8) -- (6,8) -- (5,7) --
        (6,6);
        \node[fill=white] at (7,7) {$J$};

        % Escala
        \node[fill=white, above] at (5,1.2) {$0$};
        \draw[fill=black] (5,1) rectangle (6,1.2) node[fill=white, above]{$e$};
        \draw[fill=white] (6,1) rectangle (7,1.2) node[fill=white, above]{$2e$};
        \draw[fill=black] (7,1) rectangle (8,1.2) node[fill=white, above]{$3e$};
    \end{tikzpicture}
    \caption{Ilustra\c{c}\~{a}o das regiões $J$ e $A$.}
    \label{fig:ilust_J_A}
\end{figure}

Para modelarmos o problema, discretizamos a região ilustrada na
Figura~\ref{fig:ilust_J_A} utilizando uma malha quadriculada como, ilustrado na
Figura~\ref{fig:disc_J_A}, e nomeamos cada quadrado da malha por um número
seguindo a lógica indicada na Figura~\ref{fig:disc_J_A}.
\begin{figure}[!htb]
    \centering
    \begin{tikzpicture}
        \draw[color=gray, step=.5] (0,0) grid (8,8);
        \draw[pattern=bricks] (0,0) -- (0,3) -- (2,2) -- (4,0) -- (0,0);
        \node[fill=white] at (1,1) {$A$};
        \draw[pattern=checkerboard] (6,6) -- (8,6) -- (8,8) -- (6,8) -- (5,7) --
        (6,6);
        \node[fill=white] at (7,7) {$J$};

        \draw[pattern=bricks](0,0) rectangle (2,2) node[fill=white,
        midway]{$A$};
        \draw[pattern=checkerboard] (6,6) rectangle (8,8) node[fill=white,
        midway]{$J$};

        \foreach \x in {1,...,11}{
            \node at (\x/2 - .25,7.75) {\small{$\x$}};
        }
        \foreach \x in {17,...,26}{
            \node at (\x/2 - 8.25,7.25) {\small{$\x$}};
        }

        % Escala
        \node[fill=white, above] at (5,1.2) {$0$};
        \draw[fill=black] (5,1) rectangle (6,1.2) node[fill=white, above]{$e$};
        \draw[fill=white] (6,1) rectangle (7,1.2) node[fill=white, above]{$2e$};
        \draw[fill=black] (7,1) rectangle (8,1.2) node[fill=white, above]{$3e$};
    \end{tikzpicture}
    \caption{Ilustra\c{c}\~{a}o das regiões $J$ e $A$.}
    \label{fig:disc_J_A}
\end{figure}

Pela Figura~\ref{fig:disc_J_A} \'{e} poss\'{i}vel observar que alguns elementos
da malha quadriculada encontram-se apenas parcialmente dentro de uma das
regi\~{o}es. Para corrigir isso, aproximamos as regi\~{o}es para a malha
utilizada de modo que todos os elementos da malha que encontram-se parcialmente
presentes em uma das regi\~{o}es passa a pertencer totalmente a ela. O resultado
\'{e} apresentado na Figura~\ref{fig:disc_J_A_aprox}.
\begin{figure}[!htb]
    \centering
    \begin{tikzpicture}
        \draw[color=gray, step=.5] (0,0) grid (8,8);
        \draw[pattern=bricks] (0,0) -- (0,3) -- ++(1,0) -- ++(0,-.5) -- ++(1,0)
        -- ++(0,-.5) -- ++(.5,0) -- ++(0,-.5) -- ++(.5,0) -- ++(0,-.5) --
        ++(.5,0) -- ++(0,-.5) -- ++(.5,0) -- ++(0,-.5) -- (4,0) -- (0,0);
        \node[fill=white] at (1,1) {$A$};
        \draw[pattern=checkerboard] (6,6) -- (8,6) -- (8,8) -- (6,8) --
        ++(-.5,0) -- ++(0,-.5) -- ++(-.5,0) -- ++ (0,-.5) -- ++(0,-.5) --
        ++(.5,0) -- ++(0,-.5) -- ++(.5,0) -- (6,6);
        \node[fill=white] at (7,7) {$J$};

        \draw[pattern=bricks](0,0) rectangle (2,2) node[fill=white,
        midway]{$A$};
        \draw[pattern=checkerboard] (6,6) rectangle (8,8) node[fill=white,
        midway]{$J$};

        % Escala
        \node[fill=white, above] at (5,1.2) {$0$};
        \draw[fill=black] (5,1) rectangle (6,1.2) node[fill=white, above]{$e$};
        \draw[fill=white] (6,1) rectangle (7,1.2) node[fill=white, above]{$2e$};
        \draw[fill=black] (7,1) rectangle (8,1.2) node[fill=white, above]{$3e$};
    \end{tikzpicture}
    \caption{Ilustra\c{c}\~{a}o das regiões $J$ e $A$.}
    \label{fig:disc_J_A_aprox}
\end{figure}

Seja $\phi : J \to \mathbb{R}$, $\psi: A \to \mathbb{R}$, $f: (J, A) \to
\mathbb{R}$ e $d: (J, A) \to \mathbb{R}$, onde $\phi(x)$ corresponde ao volume
de terra disponível no quadrado $x$, $\psi(y)$ ao volume de terra necessário no
quadrado $y$, $f(x,y)$ ao volume de terra transportado do quadrado $x$ para o
quadrado $y$ e $d(x, y)$ a distância entre os quadrados $x$ e $y$.

Sendo $\xi_{x,y}$ a variável de decisão correspondente ao volume de terra
transportado de $x$ para $y$, podemos modelar o problema da seguinte forma:
\begin{subequations}
    \begin{align}
        \text{max } & \sum_{x \in J} \sum_{y \in A} \xi_{x,y},
        \label{eq:model_without_obs:obj_func} \\
        \text{s.a. } & \xi_{x,y} \geq 0, && \forall x, y \in N,
        \label{eq:model_without_obs:var} \\
        & \xi_{x,y} = 0 && \forall x, y | d(x,y) > D,
        \label{eq:model_without_obs:max_dist} \\
        & \sum_{y \in A} \xi_{x,y} \leq \phi(x), && \forall x \in J,
        \label{eq:model_without_obs:max_jazida} \\
        & \sum_{x \in J} \xi_{x,y} \leq \psi(y), && \forall y \in A,
        \label{eq:model_without_obs:max_aterro}
    \end{align}
    \label{eq:model_without_obs}
\end{subequations}
onde \eqref{eq:model_without_obs:max_dist} refere-se a distância máxima dos
canos utilizados, \eqref{eq:model_without_obs:max_jazida} a quantidade de terra
que pode ser retirado de $J$ e \eqref{eq:model_without_obs:max_aterro} a
quantidade de terra necessário e $A$.

O modelo apresentado em \eqref{eq:model_without_obs} possue função objetivo e
restrições lineares. Em relação a restrição
\eqref{eq:model_without_obs:max_dist}, como $d(x, y)$ é um dado do problema
o conjunto $\left\{ (x, y) | d(x, y) > D \right\}$ é construido no
pré-processamento.

\subsection{Problema com obstáculo}
Considerando que a região $R$ pela qual os canos que fazem o transporte da terra
não podem passar é circular, temos a região de interesse ilustrada na
Figura~\ref{fig:disc_J_A_R}.
\begin{figure}[!htb]
    \centering
    \begin{tikzpicture}
        \draw[color=gray, step=.5] (0,0) grid (8,8);
        \draw[->] (-.2,8) -- (8.2,8);
        \draw[->] (0,-.2) -- (0,8.2);

        \draw[color=gray, step=.5] (0,0) grid (8,8);
        \draw[pattern=bricks] (0,0) -- (0,3) -- ++(1,0) -- ++(0,-.5) -- ++(1,0)
        -- ++(0,-.5) -- ++(.5,0) -- ++(0,-.5) -- ++(.5,0) -- ++(0,-.5) --
        ++(.5,0) -- ++(0,-.5) -- ++(.5,0) -- ++(0,-.5) -- (4,0) -- (0,0);
        \node[fill=white] at (1,1) {$A$};
        \draw[pattern=checkerboard] (6,6) -- (8,6) -- (8,8) -- (6,8) --
        ++(-.5,0) -- ++(0,-.5) -- ++(-.5,0) -- ++ (0,-.5) -- ++(0,-.5) --
        ++(.5,0) -- ++(0,-.5) -- ++(.5,0) -- (6,6);
        \node[fill=white] at (7,7) {$J$};
        \draw[pattern=fivepointed stars] (4,4) node[fill=white]{$R$}
        circle (1.7) ;

        % Escala
        \node[fill=white, above] at (5,1.2) {$0$};
        \draw[fill=black] (5,1) rectangle (6,1.2) node[fill=white, above]{$e$};
        \draw[fill=white] (6,1) rectangle (7,1.2) node[fill=white, above]{$2e$};
        \draw[fill=black] (7,1) rectangle (8,1.2) node[fill=white, above]{$3e$};
    \end{tikzpicture}
    \caption{Ilustra\c{c}\~{a}o da malha quadricular sobre a regi\~{a}o de
    interesse.}
    \label{fig:disc_J_A_R}
\end{figure}

Seja $P$ a região que não corresponde a jazida, ao aterro e nem ao obstáculo.
De maneira semelhante as definições utilizadas na subseção anterior, seja $\phi
: J \to \mathbb{R}$, $\psi: A \to \mathbb{R}$ e $f: (J, P, A) \to \mathbb{R}$,
onde $\phi(x)$ corresponde ao volume de terra disponível no quadrado $x$,
$\psi(y)$ ao volume de terra necessário no quadrado $y$, $f(x, z, y)$ ao volume
de terra transportado do quadrado $x$ para o quadrado $y$ passando pelo quadrado
$z$ e $d(x, y)$ a distância entre os quadrados $x$ e $y$\footnote{A distância
entre as células $x$ e $y$ será definida posteriormente.}. Seja também $D$ o
comprimento dos canos disponíveis, $J$ o conjunto de células que compõem a
jazida e $A$ o conjunto de células que compõem o aterro.

Então, podemos modelar o problema da seguinte forma
\begin{subequations}
    \begin{align}
        \text{min } & \sum_{x \in J} \sum_{y \in A} \xi_{x,y},
        \label{eq:model_with_obs_nl:obj_func} \\
        \text{s.a. } & \xi_{x,y} \geq 0, && \forall x, y \in N,
        \label{eq:model_with_obs_nl:var} \\
        & \xi_{x,y} = 0 && \forall d_{x,y} > D,
        \label{eq:model_with_obs_nl:max_dist} \\
        & \sum_{y \in A} \xi_{x,y} \leq \phi(x), && \forall x \in J,
        \label{eq:model_with_obs_nl:max_jazida} \\
        & \sum_{x \in J} \xi_{x,y} \leq \psi(y), && \forall y \in A,
        \label{eq:model_with_obs_nl:max_aterro}
    \end{align}
    \label{eq:model_with_obs_nl}
\end{subequations}

Como podemos observar, o modelo acima possue um conjunto de restrições não
lineares.

Seria interessante aproximar o modelo \eqref{eq:model_with_obs_nl} de modo a
obter um modelo linear. Para isso, o primeiro passo é aproximar a região $R$
utilizando o mesmo procedimento adotado para aproximar as regiões $J$ e $A$. O
resultado da aproximação da região $R$ é ilustrada na
Figura~\ref{fig:disc_J_A_R_aprox}.
\begin{figure}[!htb]
    \centering
    \begin{tikzpicture}
        \draw[color=gray, step=.5] (0,0) grid (8,8);
        \draw[->] (-.2,8) -- (8.2,8);
        \draw[->] (0,-.2) -- (0,8.2);

        \draw[color=gray, step=.5] (0,0) grid (8,8);
        \draw[pattern=bricks] (0,0) -- (0,3) -- ++(1,0) -- ++(0,-.5) -- ++(1,0)
        -- ++(0,-.5) -- ++(.5,0) -- ++(0,-.5) -- ++(.5,0) -- ++(0,-.5) --
        ++(.5,0) -- ++(0,-.5) -- ++(.5,0) -- ++(0,-.5) -- (4,0) -- (0,0);
        \node[fill=white] at (1,1) {$A$};
        \draw[pattern=checkerboard] (6,6) -- (8,6) -- (8,8) -- (6,8) --
        ++(-.5,0) -- ++(0,-.5) -- ++(-.5,0) -- ++ (0,-.5) -- ++(0,-.5) --
        ++(.5,0) -- ++(0,-.5) -- ++(.5,0) -- (6,6);
        \node[fill=white] at (7,7) {$J$};
        \draw[pattern=fivepointed stars] (3,2.5) -- ++(0,-.5) -- ++(2,0) --
        ++(0,.5) -- ++ (.5,0) -- ++(0,.5) -- ++(.5,0) -- ++(0,2) -- ++ (-.5,0)
        -- ++(0,.5) -- ++(-.5,0) -- ++(0,.5) -- ++(-2,0) -- ++(0,-.5) --
        ++(-.5,0) -- ++(0,-.5) -- ++(-.5,0) -- ++(0,-2) -- ++(.5,0) -- ++(0,-.5)
        -- (3,2.5);
        \node[fill=white] at (4,4) {$R$};

        % Escala
        \node[fill=white, above] at (5,1.2) {$0$};
        \draw[fill=black] (5,1) rectangle (6,1.2) node[fill=white, above]{$e$};
        \draw[fill=white] (6,1) rectangle (7,1.2) node[fill=white, above]{$2e$};
        \draw[fill=black] (7,1) rectangle (8,1.2) node[fill=white, above]{$3e$};
    \end{tikzpicture}
    \caption{Ilustra\c{c}\~{a}o da malha quadricular sobre a regi\~{a}o de
    interesse.}
    \label{fig:disc_J_A_R_aprox}
\end{figure}

Para evitar a distância, é possível utilizar o \flang{Bresenham's line
algorithm}.

Seja $\phi : J \to \mathbb{R}$, $\psi: A \to \mathbb{R}$ e $f: (J, A) \to \mathbb{R}$,
onde $\phi(x)$ corresponde ao volume de terra disponível na célula $x$, $\psi(y)$
ao volume de terra necessário na célula $y$, $f(x,y)$ ao volume de terra
transportado da célula $x$ para a célula $y$ e $d(x, y)$ a distância entre as
células $x$ e $y$\footnote{A distância entre as células $x$ e $y$ será definida
posteriormente.}. Seja também $D$ o comprimento dos canos disponíveis, $J$ o
conjunto de células que compõem a jazida e $A$ o conjunto de células que compõem
o aterro.

Então, podemos modelar o problema da seguinte forma
\begin{subequations}
    \begin{align}
        \text{min } & \sum_{x \in J} \sum_{y \in A} \xi_{x,y},
        \label{eq:model_with_obs:obj_func} \\
        \text{s.a. } & \xi_{x,y} \geq 0, && \forall x, y \in N,
        \label{eq:model_with_obs:var} \\
        & \xi_{x,y} = 0 && \forall d_{x,y} > D,
        \label{eq:model_with_obs:max_dist} \\
        & \sum_{y \in A} \xi_{x,y} \leq \phi(x), && \forall x \in J,
        \label{eq:model_with_obs:max_jazida} \\
        & \sum_{x \in J} \xi_{x,y} \leq \psi(y), && \forall y \in A,
        \label{eq:model_with_obs:max_aterro}
    \end{align}
    \label{eq:model_with_obs}
\end{subequations}

\subsection{Distância entre pontos}
Ao utilizar a malha quadriculada podemos definir a dist\^{a}ncia entre dois
quadrados da malha de pelo menos tr\^{e}s maneiras diferentes:
\begin{enumerate}
    \item $d_l$, que \'{e} a menor dist\^{a}ncia entre qualquer dois pontos dos
        quadrados,
    \item $d_u$, que \'{e} a maior dist\^{a}ncia entre qualquer dois pontos dos
        quadrados, e
    \item $d_c$, que \'{e} a dist\^{a}ncia entre os centros dos quadrados.
\end{enumerate}
Na Figura~\ref{fig:dist_malha} \'{e} ilustrado cada uma das dist\^{a}ncias acima
descrita.
\begin{figure}[!htb]
    \centering
    \begin{tikzpicture}
        \draw (0,0) rectangle (1,1);
        \draw (2,0) rectangle (3,1);
        \draw[<->] (1,1) -- (2,1) node[midway, below]{$d^l$};

        \draw (4,0) rectangle (5,1);
        \draw (6,0) rectangle (7,1);
        \draw (4,0) -- (7,1) node[midway, below]{$d^u$};

        \draw (8,0) rectangle (9,1) node[midway](A){};
        \draw (10,0) rectangle (11,1) node[midway](B){};
        \draw (A) -- (B) node[midway, below]{$d^c$};
    \end{tikzpicture}
    \caption{Ilustra\c{c}\~{a}o das dist\^{a}ncias entre quadrados da malha.}
    \label{fig:dist_malha}
\end{figure}

Quanto ao obst\'{a}culo
